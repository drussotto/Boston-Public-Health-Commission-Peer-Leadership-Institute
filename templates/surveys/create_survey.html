{% extends "layout.html" %}
{% block page_content %}
{% from "layout.html" import render_field %}
<div class="container-fluid">
  <h1>Create a Survey</h1>
  <form method=post>
    <div>
      <label for="name">Name</label>
      <div>
        <input id="name" name="name" type="text" value="">
      </div>
    </div>
    <div>
      <label for="answers">Questions</label>
     <button class="btn" type="button" onclick="newQuestion()">Add Question</button>
      <div>
        <ul id="questions">
          <!-- questions go here -->
        </ul>
      </div>
    </div>
    <div>
      <input type="submit" class="btn btn-primary" value="Create Survey!">
    </div>
  </form>
</div>
<div>

</div>
{% block scripts %}
{{super()}}
<script>
  function buildLi(insideList) {
    return "<li>" + insideList + "</li>";
  }

  function buildSelect(name, optionsStr) {
    var openSelect =  "<select " + "name=" + name + ">",
        closeSelect = "</select>";

    return openSelect + optionsStr + closeSelect;
  }

  function buildOption(val, label) {
    var openOpt  = "<option " + "value=" + val + ">",
        closeOpt = "</option>";

    return openOpt + label + closeOpt;
  }

  function buildOptList(q_arr) {
    optStr = ""

    for(var i = 0; i < q_arr.length; i++) {
      optStr += buildOption(q_arr[i][0], q_arr[i][1]);
    }

    return optStr
  }


  function newQuestion() {

    var newId = $("#questions").children().length;

    $.ajax({url: "/surveys/questions"}).done(function(response){
        var li = buildLi(buildSelect("question-" + newId, buildOptList(JSON.parse(response))));
        $(li).appendTo("#questions");
    });

  }
</script>
{% endblock %}
{% endblock %}
